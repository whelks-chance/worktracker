
<style>
    .project_outline {
        background-color: beige;
    }

    .project_persons {
        padding-left: 4em;
    }

    .project_person {
        padding-left: 4em;
    }

    .project_tasks {
        background-color: lavender;
        padding-left: 4em;
    }

    .project_task {
        padding-left: 4em;
    }

    .task_people {
        padding-left: 4em;
    }

    .task_preceding_tasks {
        background-color: lavenderblush;
        padding-left: 4em;
    }
</style>

{% for p in projects %}

    <div class="project_outline">
        <p>Project {{ forloop.counter }} of {{ projects|length }}</p>
        <h2>{{ p.name }}</h2>

        <p>
            {% if p.start_date %}
                The project started at {{ p.start_date }}.
            {% else %}
                The project has no recorded start date.
            {% endif %}
        </p>

        <p>
            {% if p.end_date %}
                The project is due to finish at {{ p.end_date }}.
            {% else %}
                The project will probably last forever.
            {% endif %}
        </p>

        <div class="project_persons">
            <h3>Project has {{ p.person_set.all|length }} workers assigned.</h3>
            <div class="project_person">
                {% for person in p.person_set.all %}
                    <p>{{ person.name }} is assigned

                    {% for project_person_time in p.projecttimeassignment_set.all %}
                        {% if project_person_time.person == person %}
                            for {{ project_person_time.hours }} hours,
                            {% if project_person_time.financed %}
                            <strong>funded</strong>
                                {% else %}
                                <strong>for free</strong>
                                {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </p>
            </div>

            <div class="project_person_time">
                {% for project_person_time in p.projecttimeassignment_set.all %}
                    <p>{{ project_person_time.hours }} hours are assigned</p>
                {% endfor %}
            </div>
        </div>

        <div class="project_tasks">
            <h3>Project has {{ p.task_set.all|length }} tasks.</h3>
            <div class="project_task">

                {% for task in p.task_set.all %}
                    <h4>{{ task.name }}</h4>
                    <p>Task begins {{ task.start_date }} and ends {{ task.end_date }}</p>

                    <p>{{ task.people_assigned.all|length }} people_assigned</p>

                    {% for taskpeople in task.people_assigned.all %}
                        <div class="task_people">
                            <p>{{ taskpeople.name }} is assigned to this task.</p>
                        </div>
                    {% endfor %}

                    {% for preceding_task in task.preceding_tasks.all %}
                        <div class="task_preceding_tasks">
                            <p><strong>{{ preceding_task.name }}</strong> must complete before this task begins.</p>
                        </div>
                    {% endfor %}

                {% endfor %}
            </div>
        </div>

    </div>

{% endfor %}

<h3>There are {{ people|length }} people registered in the WorkTracker (tm)</h3>
